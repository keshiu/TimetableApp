"use strict";var main=function(e){var n=[],t=!1,a=!1,r=function(e,n){var t=!1,a="";return e.forEach(function(e){"airlineCode"in e&&e.airlineCode===n&&t===!1?(t=!0,a=e.airlineLogoUrlPng):"fs"in e&&e.fs===n&&t===!1?(t=!0,a=e.city):"iata"in e&&e.iata===n&&t===!1&&(t=!0,a=e.name)}),a},o=function(e){var n=[],t=0;return e.forEach(function(e){var a={};"fs"in e?(a.fs=e.fs,a.city=e.city,n[t]=a,t++):(a.iata=e.iata,a.name=e.name,n[t]=a,t++)}),n},i=function(e,n){return e.sheduledTime>n.sheduledTime?1:e.sheduledTime<n.sheduledTime?-1:void 0},c=function(e){t===!0&&a===!0&&(e.sort(i),e.forEach(function(e){var n=$("<tr>");n.append("<td class='type'><img src = "+e.flightType+" width=20 height=20/></td>"),n.append($("<td class='number'>").text(e.flightNumber)),n.append($("<td class='airline'>").text(e.carrierCode)),n.append("<td class='logo'><img src = "+e.carrierLogo+" width=60 height=20/></td>"),n.append($("<td class='plane'>").text(e.planeType)),n.append($("<td class='destination'>").text(e.destinationCity)),n.append($("<td class='time'>").text(e.sheduledTime)),n.append(""!==e.flightStatus?$("<td class='status'>").text("рейс задержан на "+e.flightStatus+" мин"):$("<td class='status'>").text("")),n.append(""!==e.comments?$("<td class='comments'>").text(e.comments):$("<td class='comments'>").text("")),"images/departures_pictogram.png"===e.flightType?n.attr("class","depart"):n.attr("class","arrive"),$("table").find("tbody").append(n)}))},u=function(a){var i=a.flightStatuses,u=o(a.appendix.equipments),d=o(a.appendix.airports);i.forEach(function(t){var a={};if(a.flightType="images/departures_pictogram.png",a.flightNumber=t.flightNumber,a.carrierCode=t.carrierFsCode,a.carrierLogo=r(e,t.carrierFsCode),a.planeIata=t.flightEquipment.scheduledEquipmentIataCode,a.planeType=r(u,t.flightEquipment.scheduledEquipmentIataCode),a.destinationCity=r(d,t.arrivalAirportFsCode),a.sheduledTime=t.departureDate.dateLocal.split("T")[1],"undefined"!=typeof t.delays&&"undefined"!=typeof t.delays.departureGateDelayMinutes?a.flightStatus=t.delays.departureGateDelayMinutes:a.flightStatus="","undefined"!=typeof t.codeshares){for(var o=[],i=0;i<t.codeshares.length;i++)o.push(t.codeshares[i].fsCode+t.codeshares[i].flightNumber);a.comments=o.join("\n")}else a.comments="";n.push(a)}),t=!0,c(n)},d=function(t){var i=t.flightStatuses,u=o(t.appendix.equipments),d=o(t.appendix.airports);i.forEach(function(t){var a={};if(a.flightType="images/arrivals_pictogram.png",a.flightNumber=t.flightNumber,a.carrierCode=t.carrierFsCode,a.carrierLogo=r(e,t.carrierFsCode),a.planeIata=t.flightEquipment.scheduledEquipmentIataCode,a.planeType=r(u,t.flightEquipment.scheduledEquipmentIataCode),a.destinationCity=r(d,t.arrivalAirportFsCode),a.sheduledTime=t.arrivalDate.dateLocal.split("T")[1],"undefined"!=typeof t.delays&&"undefined"!=typeof t.delays.arrivalGateDelayMinutes?a.flightStatus=t.delays.arrivalGateDelayMinutes:a.flightStatus="","undefined"!=typeof t.codeshares){for(var o=[],i=0;i<t.codeshares.length;i++)o.push(t.codeshares[i].fsCode+t.codeshares[i].flightNumber);a.comments=o.join("\n")}else a.comments="";n.push(a)}),a=!0,c(n)},f=function(){alert("error")},l=new Date,s=l.getDate(),g=l.getHours(),p="https://api.flightstats.com/flex/flightstatus/rest/v2/jsonp/airport/status/SVO/dep/2015/8/"+s+"/"+g+"?appId=6b5959c3&appKey=eb2505539470ee19b8764dddfec358be&utc=false&numHours=4&maxFlights=100",y="https://api.flightstats.com/flex/flightstatus/rest/v2/jsonp/airport/status/SVO/arr/2015/8/"+s+"/"+g+"?appId=6b5959c3&appKey=eb2505539470ee19b8764dddfec358be&utc=false&numHours=4&maxFlights=100";$.ajax({dataType:"jsonp",jsonp:"callback",type:"GET",url:p}).done(u).fail(f),$.ajax({dataType:"jsonp",jsonp:"callback",type:"GET",url:y}).done(d).fail(f)};$(document).ready(function(){$.getJSON("/airlines.json",function(e){main(e)})});
